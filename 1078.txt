каждый отрезок имеет атрибут, содержащий макс глубину цепочки отрезков и атрибут-указатель на родителя в этой цепочке
для каждого из отрезков, отсортированных по длине находим его родителя с наибольшей глубиной
